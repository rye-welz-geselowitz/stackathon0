

<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Phaser - Making your first game, part 1</title>
    <script type="text/javascript" src="js/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

    //HELPER FUNCS
    var textWithBody=function(words,velocityX,velocityY,locationX,locationY,style,immovable){
        var text = game.add.text(0,0, words,style);
        text.anchor.setTo(.5);
        var textSprite = game.add.sprite(locationX,locationY,null);
        textSprite.anchor.setTo(.5);
        textSprite.addChild(text);
        textSprite.enableBody=true;
        game.physics.enable(textSprite, Phaser.Physics.ARCADE);
        textSprite.body.setSize(text.width,text.height)
        textSprite.body.bounce.y = 1;
        textSprite.body.bounce.x = 1;
        textSprite.body.gravity.y = 0;
        textSprite.body.velocity.x=velocityX;
        textSprite.body.velocity.y=velocityY;
        textSprite.body.collideWorldBounds = true;
        if(immovable){
            textSprite.body.immovable = true;
        }
        return textSprite;    
    }
    function onDown(sprite, pointer) {
        var roundTime=game.time.elapsedSince(playStart);
        var clickedText=sprite.children[0];
        var clickedString=clickedText.text;
        clickedText.setStyle(largeDarkGray);
        if(clickedString===gameInput[0].correctAnswer){
            clickedText.setStyle(largeWhite);
            words.forEach(function(word){word.body.velocity=0})
            sentence.children[0].text=gameInput[0].sentencePost;
            if(gameInput[0].isSubject){
                subjectTimes.push(roundTime);
            }
            else{
                controlTimes.push(roundTime);
            }
            gameInput.shift();
            if(gameInput.length){
                setTimeout(function(){
                    game.state.start('play');
                 }, 1500);
                
            }
            else{
                setTimeout(function(){
                    game.state.start('end');
                 }, 1500);
            }
        }
    }
    function overReady(item) {
        item.setStyle(mediumGray);
    }
    function overReadyLeave(item) {
        item.setStyle(mediumWhite);
    }
    function clickReady(item){
        game.state.start('play');
    }
    function calculateScores(){
        controlTimes.avg=parseFloat(controlTimes.reduce(function(sum, a) { return sum + a },0)/(controlTimes.length||1)/1000).toFixed(2);
        subjectTimes.avg=parseFloat(subjectTimes.reduce(function(sum, a) { return sum + a },0)/(subjectTimes.length||1)/1000).toFixed(2);
    }
    function fillGameInput(){
        gameInput=[];
        for(var i=0;i<immutableInput.length;i++){
            if(Math.random()<.5){
                gameInput.push(immutableInput[i]);
            }
            else{
                gameInput.unshift(immutableInput[i]);
            }
        }
    }

    //GAME VARIABLES
    var playStart;
    var controlTimes=[];
    var subjectTimes=[];

    //styling variables
    var mediumWhite={ font: 'bold 20pt Arial ', fill: 'white'};
    var mediumGray={ font: 'bold 20pt Arial', fill: 'gray'};
    var largeGray={ font: 'bold 30pt Arial', fill: 'gray'};
    var largeWhite={ font: 'bold 30pt Arial', fill: 'white'};
    var largeDarkGray={ font: 'bold 30pt Arial', fill: '#333333'};
    var mediumRed= { font: 'bold 20pt Arial', fill: 'red'};
    var mediumGreen= { font: 'bold 20pt Arial', fill: 'green'};

    //RECEIVING DATA
    //NOTE: need to shuffle array!!!
    var subjectName='Jamie';
    var controlName='Bill';
    var immutableInput=[{
        subjectPronouns:['She','He','They'],
        correctAnswer: 'She',
        sentencePre: 'JAMIE went to the store.',
        sentencePost: 'She went to the store.',
        isSubject: true
    },{
        subjectPronouns:['her','him','them'],
        correctAnswer: 'her',
        sentencePre: 'I love JAMIE.',
        sentencePost: 'I love her.',
        isSubject: true 
    },
    {
        subjectPronouns:['her','him','them'],
        correctAnswer: 'him',
        sentencePre: 'I drove BILL to the store.',
        sentencePost: 'I drove him to the store.',
        isSubject: false         
    },
    {
        subjectPronouns:['her','him','them'],
        correctAnswer: 'her',
        sentencePre: "Where is JAMIE'S house?",
        sentencePost: 'Where is her house?',
        isSubject: true 
    },
    {
        subjectPronouns:['he','she','they'],
        correctAnswer: 'he',
        sentencePre: 'Do you think BILL will be there?',
        sentencePost: 'Do you think he will be there?',
        isSubject: false         
    }
    ]
    var gameInput=[];
    fillGameInput();

    //STATE DEFINITIONS
    var bootState={
        create: function(){
            game.physics.startSystem(Phaser.Physics.ARCADE);
            game.state.start('load');
        }
    }
    var loadState={
        //nothing to load yet
        preload: function(){
            var loadLabel=game.add.text(game.world.centerX,game.world.centerY,'Loading...',mediumGray); 
            loadLabel.anchor.set(.5);
        },
        create: function(){
            game.state.start('instructions');
        }
    }
    var instructionsState={
         create: function(){
            var challengeString1='Whose pronouns do you know better:';
            var challengeString2=subjectName+"'s or "+controlName+"'s?";
            var instructions=game.add.text(game.world.centerX,game.world.centerY,'Click the correct pronouns.',mediumGray); 
            var readyButton=game.add.text(game.world.centerX,game.world.centerY+instructions.height*1.5,'Play',mediumWhite); 
            var challenge=game.add.text(game.world.centerX,game.world.centerY-instructions.height*3,challengeString1,mediumGray); 
            var challenge2=game.add.text(game.world.centerX,game.world.centerY-instructions.height*1.5,challengeString2,mediumGray); 
            instructions.anchor.set(.5);
            challenge.anchor.set(.5);
            challenge2.anchor.set(0.5)
            readyButton.anchor.set(.5);
            readyButton.inputEnabled=true;
            readyButton.events.onInputOver.add(overReady,this);
            readyButton.events.onInputOut.add(overReadyLeave,this);
            readyButton.events.onInputDown.add(clickReady,this);
        }       
    }
    var playState={
        create: function(){
            playStart=game.time.now;
            sentence=textWithBody(gameInput[0].sentencePre,0,0,game.world.centerX,game.world.centerY,mediumWhite,true);
            //create words group
            words=game.add.group();
            words.enableBody=true;
            for(var i=0;i<gameInput[0].subjectPronouns.length;i++){
                var word=textWithBody(gameInput[0].subjectPronouns[i],100,100,game.world.randomX,game.world.randomY,largeGray,false);
                //^HELP: font size not changing!!!
                words.add(word);
                word.inputEnabled=true;
                word.events.onInputDown.add(onDown, this);
            }
        },
        update: function(){
            game.physics.arcade.collide(sentence,words);
        }
    }
    var endState={
        create: function(){
            //Thanks for playing
            var endLabel=game.add.text(game.world.centerX,game.world.centerY,'Thanks for playing!',mediumGray); 
            endLabel.anchor.set(.5);
            //Report scores
            calculateScores();
            var scoreReportSubject='Average time for '+subjectName+': '+subjectTimes.avg.toString()+ ' s';
            var scoreReportControl='Average time for '+controlName+': '+controlTimes.avg.toString()+' s';

            var subjectScore=game.add.text(game.world.centerX,game.world.centerY+40,scoreReportSubject,mediumWhite); 
            var controlScore=game.add.text(game.world.centerX,game.world.centerY+80,scoreReportControl,mediumWhite); 
            subjectScore.anchor.set(.5);
            controlScore.anchor.set(.5);
            if(subjectTimes.avg<controlTimes.avg){
                subjectScore.setStyle(mediumGreen)
                controlScore.setStyle(mediumRed)
            }
            if(subjectTimes.avg>controlTimes.avg){
                subjectScore.setStyle(mediumRed)
                controlScore.setStyle(mediumGreen)
            }
            //Reset Scores
            controlTimes=[];
            subjectTimes=[];
            fillGameInput();
            //Replay button
            var readyButton=game.add.text(game.world.centerX,game.world.centerY+120,'Replay',mediumWhite); 
            readyButton.anchor.set(.5);
            readyButton.inputEnabled=true;
            readyButton.events.onInputOver.add(overReady,this);
            readyButton.events.onInputOut.add(overReadyLeave,this);
            readyButton.events.onInputDown.add(clickReady,this);

        }
    }
    var game=new Phaser.Game(800,600,Phaser.AUTO,'');
    game.state.add('boot',bootState);
    game.state.add('load',loadState);
    game.state.add('instructions',instructionsState);
    game.state.add('play',playState);
    game.state.add('end',endState);

    game.state.start('boot');

</script>

</body>
</html>